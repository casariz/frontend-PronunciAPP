<div class="container">
    <div class="pronunciation-box">
        <header class="section-header">
            <h1 class="title">Veamos tu pronunciación</h1>
            <p class="instructions">Lee el siguiente texto y presiona el micrófono para grabar</p>
        </header>

        <div class="text-box">
            <p class="sample-text">The quick brown fox jumps over the lazy dog.</p>
        </div>

        <div>
            <p class="instructions">
                Nota: Este pangrama contiene todas las letras del alfabeto inglés al menos una vez.
            </p>
        </div>

        <div class="action-section">
            <button class="record-button" [class.recording]="isRecording" (click)="startRecording()"
                [disabled]="isProcessing || showNameInput"> <!-- Deshabilitar si el input de nombre está visible -->
                <i class="fa-solid" [class.fa-microphone]="!isRecording" [class.fa-stop]="isRecording"
                    style="margin-right: 10px;"></i>
                <span>{{ isRecording ? 'Detener grabación' : 'Iniciar grabación' }}</span>
            </button>

            <p *ngIf="isRecording" class="recording-indicator">
                <i class="fa-solid fa-circle pulse"></i> Grabando...
            </p>

            <div *ngIf="isProcessing" class="processing-container">
                <div class="spinner">
                    <div class="spinner-outer"></div>
                    <div class="spinner-inner"></div>
                </div>
                <div class="processing-text">Procesando audio...</div>
            </div>
        </div>

        <div *ngIf="audioUrl && !isProcessing && !processedAudioUrl" class="result-container" style="margin-top: 20px;">
            <h2 class="result-title">¡Grabación completada, pero algo falló!</h2>

            <p class="file-info">
                <i class="fa-solid fa-circle-info"></i>
                <span style="margin-left: 10px;">El audio se ha grabado correctamente, pero no se pudo procesar.</span>
            </p>
        </div>

        <div *ngIf="processedAudioUrl" class="result-container">
            <h2 class="result-title" style="margin-top: 20px;">Resultado</h2>

            <div *ngIf="textOutput" class="text-output">
                <h3 class="text-output-heading">El modelo tomó tu voz y entendió esto:</h3>
                <p class="recognized-text">{{ textOutput }}</p>
            </div>

            <div class="audio-controls">
                <audio controls [src]="processedAudioUrl" class="audio-player"></audio>
                <button class="download-button" (click)="downloadProcessedAudio()">
                    <i class="fa-solid fa-file-arrow-down"></i>
                    <p style="margin-left: 10px;">Descargar audio</p>
                </button>
            </div>

            <!-- Enlace al formulario -->
            <div style="margin-top: 24px; text-align: center;">
                <a href="https://forms.gle/VL6d1MnbriaJntiE9" target="_blank" rel="noopener"
                    style="color: #4285F4; font-weight: 500; text-decoration: underline;">
                    ¿Nos ayudas? Completa este breve formulario
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Componente flotante para el nombre -->
<div *ngIf="showNameInput" class="floating-name-input-overlay">
    <div class="floating-name-input-content">
        <p>Por favor, digita tu nombre</p>
        <input type="text" [(ngModel)]="userName" placeholder="Escribe tu nombre aquí" class="name-input-field">
        <div class="floating-name-input-actions">
            <button (click)="confirmAndStartRecording()" [disabled]="!userName.trim()" class="confirm-button">Grabar con este nombre</button>
            <button (click)="cancelNameInput()" class="cancel-button">Cancelar</button>
        </div>
    </div>
</div>